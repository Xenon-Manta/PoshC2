

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Service Level Persistence &mdash; PoshC2 Framework  documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../genindex.html"/>
        <link rel="search" title="Search" href="../search.html"/>
    <link rel="top" title="PoshC2 Framework  documentation" href="../index.html"/>
        <link rel="up" title="Persistence" href="index.html"/>
        <link rel="next" title="Modules" href="../modules/index.html"/>
        <link rel="prev" title="Executable Persistence" href="persistence4.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> PoshC2 Framework
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../install_and_setup/index.html">Installation &amp; Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../execution/index.html">Execution / Payloads</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core/index.html">Core Implant / Features</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Persistence</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="persistence1.html">Registry Run Key</a></li>
<li class="toctree-l2"><a class="reference internal" href="persistence2.html">Scheduled Task</a></li>
<li class="toctree-l2"><a class="reference internal" href="persistence3.html">Startup Lnk File</a></li>
<li class="toctree-l2"><a class="reference internal" href="persistence4.html">Executable Persistence</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Service Level Persistence</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#install-servicelevel-persistence">Install-ServiceLevel-Persistence</a></li>
<li class="toctree-l3"><a class="reference internal" href="#install-servicelevel-persistencewithproxy">Install-ServiceLevel-PersistenceWithProxy</a></li>
<li class="toctree-l3"><a class="reference internal" href="#remove-servicelevel-persistence">Remove-ServiceLevel-Persistence</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../modules/index.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../lateral_movement/index.html">Lateral Movement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reporting/index.html">Reporting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../license/index.html">License</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">PoshC2 Framework</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Persistence</a> &raquo;</li>
        
      <li>Service Level Persistence</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/persistence/persistence5.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="service-level-persistence">
<h1>Service Level Persistence<a class="headerlink" href="#service-level-persistence" title="Permalink to this headline">¶</a></h1>
<p>Mitre ATT&amp;CK - <a class="reference external" href="https://attack.mitre.org/wiki/Technique/T1050">New Service</a></p>
<p><strong>Requires: Elevated User</strong></p>
<p>This persistence requires elevated rights and will create a new service on the system using “sc.exe”. The new service is called “CPUpdater” to try and fit in with other service names and not stand out. Before laying this type of persistence you need to understand whether the SYSTEM account is allowed to egress the corporate web proxy, if not you will need to create a Proxy aware payload using the “CreateProxyPayload” command.</p>
<div class="section" id="install-servicelevel-persistence">
<h2>Install-ServiceLevel-Persistence<a class="headerlink" href="#install-servicelevel-persistence" title="Permalink to this headline">¶</a></h2>
<p>To add this persistence use the following command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Install</span><span class="o">-</span><span class="n">ServiceLevel</span><span class="o">-</span><span class="n">Persistence</span>
</pre></div>
</div>
<p>Installs a new service called “CPUpdater” using “sc.exe” to run the dropper:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sc</span><span class="o">.</span><span class="n">exe</span> <span class="n">create</span> <span class="n">CPUpdater</span> <span class="n">binpath</span><span class="o">=</span> <span class="s1">&#39;cmd /c &quot;$payload&quot; Displayname= CheckpointServiceUpdater start= auto</span>
</pre></div>
</div>
</div>
<div class="section" id="install-servicelevel-persistencewithproxy">
<h2>Install-ServiceLevel-PersistenceWithProxy<a class="headerlink" href="#install-servicelevel-persistencewithproxy" title="Permalink to this headline">¶</a></h2>
<p>This will do the same as above but use the Proxy Aware dropper that will be created by using “CreateProxyPayload”.</p>
<p>To add this persistence use the following command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Install</span><span class="o">-</span><span class="n">ServiceLevel</span><span class="o">-</span><span class="n">PersistenceWithProxy</span>
</pre></div>
</div>
</div>
<div class="section" id="remove-servicelevel-persistence">
<h2>Remove-ServiceLevel-Persistence<a class="headerlink" href="#remove-servicelevel-persistence" title="Permalink to this headline">¶</a></h2>
<p>To remove this persistence use the following command:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Remove</span><span class="o">-</span><span class="n">ServiceLevel</span><span class="o">-</span><span class="n">Persistence</span>
</pre></div>
</div>
<p>Removes the service using “sc.exe”:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sc</span><span class="o">.</span><span class="n">exe</span> <span class="n">delete</span> <span class="n">CPUpdater</span>
</pre></div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../modules/index.html" class="btn btn-neutral float-right" title="Modules" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="persistence4.html" class="btn btn-neutral" title="Executable Persistence" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Nettitude.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>